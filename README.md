# Project Siren

**창팝 월드컵 유튜브 타임라인 자동 생성기** (Changpop World Cup YouTube Timeline Generator)

## 프로젝트 소개

Project Siren은 창작 팝송(창팝) 월드컵 유튜브 영상에서 노래 재생 시간을 자동으로 감지하여 타임라인을 생성해주는 도구입니다. Shazam과 유사한 오디오 지문(audio fingerprint) 기술을 활용하여 여러 곡이 연속해서 재생되는 영상에서 각 노래의 시작 시간을 정확하게 찾아내 타임라인을 생성합니다.

## 주요 기능

- 유튜브 영상에서 오디오 추출
- Shazam 알고리즘 기반 오디오 지문(fingerprint) 생성 및 저장
- 영상 내 노래 감지 및 타임라인 생성

## 사용 가이드

### 1. 설치 및 준비

1. 필요 라이브러리 설치:

```bash
pip install -r requirements.txt
```

2. 프로젝트 다운로드:

```bash
git clone https://github.com/your-username/project-siren.git
cd project-siren
```

### 2. 오디오 지문 생성하기

월드컵에 사용된 노래들의 지문을 먼저 생성해야 합니다.

1. 노래 목록 파일 작성:
   - `songs.txt` 파일을 생성하고 다음 형식으로 작성:

   ```
   노래제목1: https://www.youtube.com/watch?v=xxxx
   노래제목2: https://www.youtube.com/watch?v=yyyy
   ```

   - 각 노래는 별도 라인에 작성하고, 노래 제목과 URL은 콜론(:)으로 구분
   - URL은 반드시 YouTube 동영상 URL 형식이어야 함

2. 오디오 지문 생성 명령 실행:
```bash
python -m main.audioprint --urls songs.txt --name "월드컵이름"
```
   - 이 과정에서 프로그램은 다음과 같은 작업을 수행합니다:
     - 각 노래의 짧은 샘플(기본 30초)을 다운로드
     - 각 샘플에서 오디오 지문 생성
     - 생성된 지문을 `audioprints/월드컵이름/` 디렉토리에 저장
   - 처리 진행 상황이 터미널에 표시됩니다

### 3. 타임라인 생성하기

1. 월드컵 영상의 타임라인 생성:
```bash
python -m main.timeline --url "https://www.youtube.com/watch?v=영상ID" --worldcup "월드컵이름" --start "00:00:00" --end "02:00:00"
```

2. 옵션 자세한 설명:
   - `--url`: 타임라인을 생성할 YouTube 영상 URL (필수)
   - `--worldcup`: 이전에 생성한 오디오 지문 모음의 이름 (필수)
   - `--start`: 분석 시작 시간 (HH:MM:SS 형식, 기본값: "00:00:00")
   - `--end`: 분석 종료 시간 (HH:MM:SS 형식, 기본값: "00:10:00")
   - `--chunk`: 분석할 오디오 청크 크기(초) (기본값: 60)
   - `--hop`: 다음 청크로 이동할 간격(초) (기본값: 30)
   - `--threshold`: 감지 유사도 임계값 (기본값: 0.001) - 값이 작을수록 더 많은 곡을 감지하지만 오탐지 가능성 증가
   - `--trace`: 오류 발생 시 상세 정보 출력 (선택 사항)

3. 결과 해석:
   - 프로그램이 성공적으로 실행되면 감지된 노래 목록과 해당 시작 시간이 터미널에 출력됩니다
   - 출력 형식은 `노래제목 HH:MM:SS`입니다
   - 또한 타임라인에 감지되지 않은 노래 목록도 함께 표시됩니다

## 프로젝트 설계

### 구조

```
project-siren/
│
├── main/                   # 메인 실행 모듈
│   ├── audioprint/         # 오디오 지문 생성 메인
│   └── timeline/           # 타임라인 생성 메인
│
├── src/                    # 소스 코드 디렉토리
│   ├── audioprint/         # 오디오 지문 생성 관련 코드
│   ├── timeline/           # 타임라인 생성 관련 코드
│   ├── utils/              # 유틸리티 함수
│   └── youtube_download/   # 유튜브 다운로드 관련 코드
│
└── audioprints/            # 생성된 오디오 지문 저장 디렉토리
```

### 작동 원리

1. **오디오 지문 생성 (Shazam 알고리즘 기반)**:
   - YouTube에서 노래 샘플 다운로드 (최초 30초)
   - 오디오를 mono 채널로 변환 및 표준 샘플레이트로 리샘플링
   - 짧은 프레임 단위로 오디오 분할 (프레임 크기: 2048 샘플, 홉 크기: 640 샘플)
   - 각 프레임에 대해 FFT(Fast Fourier Transform) 수행하여 스펙트럼 생성
   - 스펙트럼에서 주요 주파수 피크 추출 (최대 30개)
   - 주파수 대역별로 최적의 피크 선택 (5개 대역, 각 대역당 최대 6개 피크)
   - 선택된 피크 쌍 간의 관계를 해시로 변환 (앵커 피크와 타겟 피크)
   - 해시 테이블에 시간 정보와 함께 저장 (키: 해시값, 값: 시간 정보)
   - 생성된 지문을 pickle 형식으로 파일에 저장

2. **타임라인 감지**:
   - YouTube 영상 지정 구간 다운로드
   - 청크 단위로 분할하여 처리 (기본: 60초 단위, 30초씩 이동)
   - 각 청크의 오디오 지문 위와 동일한 방식으로 생성
   - 청크의 지문과 노래 지문 간의 매칭:
     - 공통 해시 키 찾기
     - 각 해시 쌍의 시간 오프셋 계산 (청크 시간 - 노래 시간)
     - 시간 오프셋 히스토그램에서 최빈값 찾기
     - 최빈값의 빈도수로 유사도 계산
   - 유사도가 임계값을 넘는 노래와 시작 시간 감지
   - 각 노래별로 가장 높은 유사도를 가진 시간대 선택
   - 시간순으로 타임라인 생성 및 출력

## 오디오 지문 기술

이 프로젝트는 Shazam과 유사한 오디오 지문 기술을 사용합니다:
- 스펙트로그램에서 주파수 피크를 추출
- 피크 간의 관계(시간과 주파수 차이)를 해시로 변환
- 노래 식별을 위해 해시 매칭 알고리즘 적용
- 시간 오프셋 히스토그램 분석을 통한 정확한 시작 시간 감지

## 사용 기술

- **언어**: Python 3.8+
- **오디오 처리**: 
  - essentia: 오디오 분석 및 특징 추출
- **최적화**:
  - numba: 성능 최적화 (JIT 컴파일)
  - 병렬 처리 및 메모리 최적화
- **다운로드**:
  - yt-dlp: YouTube 비디오 다운로드
- **데이터 관리**:
  - pickle: 오디오 지문 데이터 직렬화
- **시스템 모니터링**:
  - psutil: 시스템 리소스 모니터링

## 제한사항

- **시스템 요구사항**: 최소 6GB 이상의 여유 메모리를 권장합니다.
- **긴 영상 주의**: 2시간 이상의 영상을 처리할 경우 메모리 부족(out of memory) 오류가 발생할 수 있습니다.
- **인식 정확도**: 오디오 지문 인식은 노래의 특성과 배경 소음에 따라 정확도가 달라질 수 있습니다.
- **YouTube 제한**: YouTube 정책 변경으로 다운로드 기능이 영향을 받을 수 있습니다.

## 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다.

## 프로젝트 위키

다음 사이트에서 영어로 제공됩니다: https://deepwiki.com/ned-razzz/youtube-timeline-generator/1-overview

프로젝트 설계가 궁금하시다면 참고하시길 바랍니다.
